// © SuperSaaS 2011
function redirect_l(a){redirect_k(a.value==0?"All":a.options[a.selectedIndex].text)}function redirect_k(a){var b=url_balder.concat("/",encodeURIComponent(a.replace(/ /g,"_")));view!=""&&(b=b.concat("?day=",cursor.getUTCDate(),"&month=",cursor.getUTCMonth()+1,"&year=",cursor.getUTCFullYear(),"&view=",view)),window.location=b}function showflags(a){accid==-2&&(accid=a,new Ajax.Updater("flagbox","/partials/flags.html",{method:"get"}),$("flagbox").observe("mouseleave",function(){this.hide()})),new Effect.BlindDown("flagbox",{duration:.25})}function changetld(a,b){var c=new String(window.location.protocol+"//"+window.location.host),d=new String(window.location.pathname+window.location.search);/[\?&]lang=(\w\w)/.test(d)?d=d.replace(/([\?&])lang=\w\w/,"$1lang="+a):d+=(d.indexOf("?")==-1?"?":"&")+"lang="+a,/(.*supersaas\.)(co.uk|\w{2,3})(.*)/.test(c)&&b!=RegExp.$2&&window.location.protocol!="https:"?window.location=c+"/api/change_tld/"+accid+"?tld="+b+"&after="+encodeURIComponent(d):window.location=c+d,new Effect.BlindUp("flagbox",{duration:.3})}function jump(a,b){var c,d=/[\?&]res\[(\w+)\]=([^&]+)/g,e=window.location.href.split("?")[0];/[\?&]lang=(\w\w\w?)/.test(window.location)?e+="?lang="+RegExp.$1+"&":e+="?";while(c=d.exec(window.location))e+="res["+c[1]+"]="+c[2]+"&";/per_page=(\d+)/.test(window.location)&&(e+="per_page="+RegExp.$1+"&"),/per_slot=(\d+)/.test(window.location)&&(e+="per_slot="+RegExp.$1+"&"),b?window.location=e.concat("day=",cursor.getUTCDate(),"&month=",cursor.getUTCMonth()+1,"&year=",cursor.getUTCFullYear(),"&view=",a):window.location=e.concat("view=",a,"&today=true")}function jumper(a,b){cursor.setTime(jump_offset.getTime()+b*daylength),jump(a,!0)}function base_jumper(a,b,c){if(c!=0){var d=cursor.getUTCDate(),e=cursor.getUTCMonth()+c;cursor.setUTCMonth(e),cursor.getUTCDate()<d&&(b=-cursor.getUTCDate())}b!=0&&cursor.setTime(cursor.getTime()+b*daylength),jump(a,!0)}function bjump(a){window.location=a+"?after="+encodeURIComponent(window.location)}function rjump(a){return window.location=a.href+"?return="+encodeURIComponent(window.location.pathname+window.location.search),!1}function download_ical(a){window.location=download_url.concat("/",$(a+"_id").value,a!="oldres"?"s":"")}function jump_to_form(a){var b=new String(window.location);window.location=b+(b.indexOf("?")==-1?"?":"&")+"fid="+(form_id||"new")+(a?"&rid="+$(capacity?"oldbooking_id":"oldres_id").value:"")}function chandle(a,b,c){var d=a.target?a.target:a.srcElement,e=new Date(jump_offset.getTime()+b*daylength),f=view=="month"?"TD":"TR";while(d.id.indexOf("_")==-1&&d.nodeName!=f)d=d.parentNode;if(d.id.indexOf("_")==-1){if(auth_write==0){capacity||displayatmouse("reservation",a);return}if(grid){hideDialog("reservation");return}var g=c>=0?60*Number(d.rowIndex)/interval+c*60:typeof start!="undefined"?start[0]:720;res.length>0?f=dir==0?res[Math.floor((a.clientX-$(d).cumulativeOffset()[0])*res.length/d.offsetWidth)]:f=res[Math.floor(Math.max(Event.pointerY(a)-$(d).cumulativeOffset()[1]-16,0)*res.length/(d.offsetHeight-15))]:f=0,newres(a,capacity?"slot":"reservation",e,g/60,g%60,f)}else{var h=d.id.substring(1,d.id.indexOf("_"));if(d.id.substr(0,1)=="e"){if(auth_write==0){displayatmouse("reservation",a);return}if(d.id.substr(1,1)!="x"){var i=d.id.substring(d.id.indexOf("_")+1);newres(a,"reservation",e,start[h]/60,start[h]%60,res[i])}}else edtarget=d.id,capacity?viewslot(a,h):editres(a,h)}}function editres(a,b){if(chip[b][5]==null)return;setcontent("oldres",b,chip,chip_fields);var c=window.location.pathname.split("/"),d=encodeURIComponent(decodeURIComponent(c[2]=="supervise"?c[3]:c[2]));if(chip[b][4]){$("oldres_res").innerHTML='<a href="/ajax/findapp/'+chip[b][4]+"?account="+d+'">'+chip[b][chip[b].length-1].escapeHTML()+"</a>",$("oldres_resr").show();var e=$("approve");e&&(e.hide(),$("revert").hide())}else $("oldres_resr").hide();displayatmouse("oldres",a)}function setcontent(a,b,c,d){for(var e=0;e<d.length;e++)clearNset(a,d[e],c[b][e+1]);$(a+"_id").value=b;var f=c[b][0];a=="oldres"&&c[b][4]&&(f=0);if($(a+"_repeat")){$(a+"_change_0").checked=!0,$(a+"_repeater").value=0;switch(f){case 0:$(a+"_changeS").hide(),$(a+"_repeat").hide();break;case 1:case 2:$(a+"_until").hide(),$(a+"_until2").hide(),$(a+"_changeS").hide(),$(a+"_repeat").show();break;case 3:$(a+"_changeS").show(),$(a+"_repeat").hide()}}var g=$("form_plus");g&&(c[b][0]&&(a!="oldres"||!c[b][4])&&!form_id?g.show():g.hide());if(a=="oldslot"||(f&1)==enabled)return;enabled=f&1;if(enabled){for(e=0;e<d.length;e++)ignoref.indexOf(d[e])==-1&&(g=$(a+"_"+d[e]),g.tagName&&g.tagName.toUpperCase()=="SELECT"?g.enable():g.readOnly=!1);$(a+"_req")!=null&&$(a+"_req").show(),$(a+"_edit").show(),$(a+"_view").hide(),$(a+"_sedit").enable(),g=$(a+"_sdestroy"),g&&g.enable(),$(a+"_editlink").show()}else{for(e=0;e<d.length;e++)ignoref.indexOf(d[e])==-1&&(g=$(a+"_"+d[e]),g.tagName&&g.tagName.toUpperCase()=="SELECT"?g.disable():g.readOnly=!0);$(a+"_req")!=null&&$(a+"_req").hide(),$(a+"_edit").hide(),$(a+"_view").show(),$(a+"_sedit").disable(),g=$(a+"_sdestroy"),g&&g.disable(),$(a+"_editlink").hide()}}function viewslot(a,b){hideDialog("oldslot"),hideDialog("oldbooking");if($("bbox_slot_id").value!=b||$("bbox_content").innerHTML=="")setslothead("bbox",b),$("bbox_description").innerHTML=markdown(chip[b][5]),chip[b][8]==0?$("bbox_content").innerHTML=empty:getslot(b,1,"");overbooking!=2&&$("bbox_new")&&(chip[b][3]>0&&chip[b][3]<=chip[b][8]||chip[b][8]==-2||chip[b][3]==-2?$("bbox_new").hide():$("bbox_new").show()),displayatmouse("bbox",a)}function abortajax(a){a&&a.transport.readyState<4&&(a.transport.abort(),a=!1)}function getslot(a,b,c){abortajax(ajaxobj),$("bbox_content").innerHTML='<img id="ajaxspin" src="//d304pchb3b61hb.cloudfront.net/img/progress.gif" alt="Busy..."/>';var d=$H();b!=1&&d.set("page",b),c!=""&&d.set("order",c),/role=(\w+)/.test(window.location)&&d.set("role",RegExp.$1),/per_slot=(\d+)/.test(window.location)&&d.set("per_slot",RegExp.$1),d=d.toQueryString(),ajaxobj=new Ajax.Updater("bbox_content","/ajax/slotlist/"+a+(d!=""?"?"+d:""),{method:"get",evalScripts:!0})}function setslothead(a,b){chip[b][4]==""?($(a+"_title").innerHTML=prettyTime(chip[b][1],chip[b][2],!0),local?($(a+"_date").innerHTML=prettyLocal(chip[b][1],chip[b][2]),$(a+"_date").show()):$(a+"_date").hide()):($(a+"_title").innerHTML=chip[b][4].escapeHTML(),$(a+"_date").innerHTML=prettyTime(chip[b][1],chip[b][2],!0)+(local?prettyLocal(chip[b][1],chip[b][2]):""),$(a+"_date").show()),$(a+"_location").innerHTML=joiner(markdown(chip[b][6]),creprice(b,!0));var c=chip[b][3],d=chip[b][8],e='<div class="col'+chip[b][9]+' number">';if(c<=0)e=d<0?"":e+d+"</div>";else if(d<0)e+=c+"</div>";else{e+=d+" / "+c+"</div>";var f=chip[b][10],g=f+c-d,h="";f>0&&(e+='<span class="s r">'+(f==1?ind[lang][3]:f+" "+ind[lang][4])+"</span>"),g>0?h='<span class="s">'+g+" "+ind[lang][0]+"</span>":g<0?h='<span class="s r">'+ind[lang][2]+"</span>":f==0&&(h='<span class="s" style="color:green">'+ind[lang][1]+"</span>"),e+=f>0?"<br/>"+h:h}if(c<-1||d<-1)e+='<span class="s r">'+ind[lang][1]+"</span>";$(a+"_level").innerHTML=e,$(a+"_slot_id").value=b,overbooking==3&&$("bbox_new")&&(c>0&&c<=d||d==-2||c==-2?$(a+"_wait").show():$(a+"_wait").hide())}function joiner(a,b){return a==""||b==""?a+b:a+"<br/>"+b}function newresnow(a,b,c){var d=new Date;d.setTime(d.getTime()+(c?c*1e3:daylength)),typeof start!="undefined"?newres(a,b,d,start[0]/60,start[0]%60):newres(a,b,d,d.getHours(),0)}function newres(a,b,c,d,e,f){var g=c.getUTCFullYear(),h=c.getUTCMonth(),i=c.getUTCDate();daysonly&&(d=0,e=0);var j=new Date(Date.UTC(g,h,i,Math.floor(d),e));clearNset(b,"start_time",j),length_sel?setFinish(b):clearNset(b,"finish_time",new Date(j.getTime()+default_length*1e3)),displayatmouse(b,a),f!=null&&f!=0&&($(b+"_resource_id").value=f),reprice("reservation")}function newbooking(){var a="booking",b=$("bbox_slot_id").value;newcache!=b&&(newcache=b,setslothead(a,b),$((a+="_repeat_")+"a")&&(abortajax(ajaxobj2),$(a+"b")?(chip[b][0]==3?($(a+"a").show(),$(a+"b").show()):$(a+"a").hide(),$(a+"c").hide().innerHTML=""):chip[b][0]!=2?($(a+"c").innerHTML='<img src="//d304pchb3b61hb.cloudfront.net/img/progress.gif" alt="Busy..."/><input name="booking[repeat][]" type="hidden" value="0"/>',ajaxobj2=new Ajax.Updater(a+"c","/ajax/repeatlist/"+b+"?df="+date_format+"&tf="+time_format+"&uid="+uid+"&rlim="+rlim+"&wl="+overbooking,{method:"get"}),$(a+"a").show()):($(a+"a").hide(),$(a+"c").innerHTML=""))),displaybox("booking",$("bbox_xpos").value,$("bbox_ypos").value),creprice("booking"),hideDialog("bbox")}function editbooking(a,c,d){var e="oldbooking";setcontent(e,c,b,chip_fields),d>0?$(e+"_wait").show():$(e+"_wait").hide(),$(e+"_changeS")&&(abortajax(ajaxobj3),ajaxobj3=!1,$(e+"_change_0").checked=!0,b[c][0]==3?($(e+"_changeS").show(),$(e+"_changeR").innerHTML=""):$(e+"_changeS").hide()),displayatmouse(e,a)}function findrepeat(a){$("booking_repeat_b").hide(),abortajax(ajaxobj2),$("booking_repeat_c").innerHTML='<img src="//d304pchb3b61hb.cloudfront.net/img/progress.gif" alt="Busy..."/>',$("booking_repeat_c").show(),ajaxobj2=new Ajax.Updater("booking_repeat_c","/ajax/repeatlist/"+$("booking_slot_id").value+"?df="+date_format+"&tf="+time_format+"&uid="+a+"&wl="+overbooking,{method:"get"})}function findchanges(){ajaxobj3||($("oldbooking_changeR").innerHTML='<img src="//d304pchb3b61hb.cloudfront.net/img/progress.gif" alt="Busy..."/>',ajaxobj3=new Ajax.Updater("oldbooking_changeR","/ajax/changelist/"+$("oldbooking_id").value+"?df="+date_format,{method:"get"})),$("oldbooking_changeR").show()}function editslot(){hideDialog("bbox");var a=$("bbox_slot_id").value;setcontent("oldslot",a,chip,["start_time","finish_time","capacity","title","description","location","price"]),$("oldslot_level").update(chip[a][8]),$("oldslot_color").value=chip[a][9],$("oldslot_level").className="csel col"+chip[a][9],displaybox("oldslot",$("bbox_xpos").value,$("bbox_ypos").value)}function changecol(a){var b=$(a.id.replace("level","color")),c=(parseInt(b.value)+1)%10;b.value=c,a.className="csel col"+c}function showuntil(a){var b=a.id.replace(/repeater/,"until");a.value==0?($(b).hide(),$(b+2).hide()):$(b).visible()||($(b+"_time").value="",$(b).show(),$(b+2).show())}function displayatmouse(a,b){var c=b.clientY;c+=document.viewport.getScrollOffsets().top,displaybox(a,b.clientX,c)}function displaybox(a,b,c){var d=$("container"),e=$(a),f=e.style,g=document.viewport.getScrollOffsets().top;b=parseInt(b),c=parseInt(c),$(a+"_error")!=null&&$(a+"_error").hide(),f.left=b+"px",f.top=c+"px",e.show(),b+e.offsetWidth>d.offsetWidth&&(b=d.offsetWidth-e.offsetWidth,f.left=b+"px",g>0&&Prototype.Browser.WebKit&&(e.style.display="none",e.offsetHeight,e.style.display="block")),c+e.offsetHeight>document.body.offsetHeight+20&&(c=document.body.offsetHeight+20-e.offsetHeight,c<0&&(c=0),f.top=c+"px"),document.viewport.getHeight()+g<c+e.offsetHeight&&e.scrollIntoView(!1),$(a+"_xpos").value=parseInt(f.left),$(a+"_ypos").value=parseInt(f.top),$("flash").visible()&&new Effect.Fade("flash")}function clearNset(a,b,c){var d;b=="form_id"&&(d=$("form_icon"))&&(c==""?(d.hide(),form_id=!1):(d.show(),form_id=c));if(!(d=$(a+"_"+b)))return;if(b=="status"){statcache!=c&&(statcache=c,c==""?$(a+"_statrow").hide():(d.innerHTML=c,$(a+"_statrow").show())),d=$("approve"),d&&(c.indexOf("  ")==-1?(d.show(),$("revert").hide()):(d.hide(),$("revert").show()));return}b=="updated_by"?c==""?$(a+b).hide():$(a+b).show():d.parentNode.tagName=="SPAN"&&(d.parentNode.style.padding="0",d.parentNode.style.backgroundColor="white",d.parentNode.style.display="inline"),b=="country"&&build_clist(a+"_"+b,c);if(b=="price_cents"){d.innerHTML=show_currency(c),$(a+"_price").innerHTML="";return}b.indexOf("time")>0?(d.value=c?timeToString(c,b.indexOf("finish")>=0):"–",local&&setlocal(a+"_"+b,c)):b.indexOf("_by")>0?d.innerHTML=c.escapeHTML():d.value=b=="price"?format_price(c):c}function hideDialog(a){if(!$(a))return;$(a).hide(),picked_el&&picked_el.descendantOf(a)&&hide_datepick()}function removeRes(a){if(a=="oldslot"&&$("oldslot_level").innerHTML>0&&!confirm(delete_warning[lang]||"This will also delete reservations. Are you sure?"))return!1;hideDialog(a),$(a+"_progress").show();if(view==""||view=="agenda"||view=="free"){var b="c"+$(a+"_id").value;return $(b)&&new Effect.Shrink(b),!0}if(!edtarget)return!0;new Effect.Puff(edtarget);var c=edtarget.indexOf("_");if(c<0)return nil;var d=edtarget.substring(0,c),e=Number(edtarget.substring(c+1)),f,g;for(f=e+1;!0;f++){g=$(d+"_"+f);if(g==null)break;new Effect.Puff(g)}for(f=e-1;f>=0;f--){g=$(d+"_"+f);if(g==null)break;new Effect.Puff(g)}return!0}function timeToString(a,b){daysonly&&b&&(typeof start=="undefined"||start[0]==1440)&&(a=new Date(a.getTime()-1e3));var c=dateToString(a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate());return daysonly?c:c+minhour(a.getUTCHours(),a.getUTCMinutes())}function minhour(a,b){return b<10&&(b="0"+b),time_format==0?"  ".concat(Math.floor(a),":",b):a<12?" ".concat(Math.floor(a<1?12:a),":",b,"am"):" ".concat(Math.floor(a>12?a-12:a),":",b,"pm")}function dateToString(a,b,c){switch(date_format){case 1:return b+"/"+c+"/"+a;case 2:return c+"/"+b+"/"+a;case 3:return c+"."+b+"."+a;case 4:return a+"/"+b+"/"+c;default:return a+"-"+(b<10?"0":"")+b+"-"+(c<10?"0":"")+c}}function monthdayString(a,b){switch(date_format){case 0:return a+"-"+b;case 1:case 4:return a+"/"+b;case 3:return b+"."+a;default:return b+"/"+a}}function prettyTime(a,b,c){var d=a.getUTCMonth()+1,e=a.getUTCDate(),f=a.getUTCHours(),g=a.getUTCMinutes(),h="";c&&(h=days[lang][a.getUTCDay()],date_format==4?h=monthdayString(d,e)+" ("+h+")":h+=" "+monthdayString(d,e));if(!daysonly||f>0||g>0)h+=(c?"&nbsp;":"")+minhour(f,g);h+=" &ndash; ";var i=b.getUTCMonth()+1,j=b.getUTCDate();f=b.getUTCHours(),g=b.getUTCMinutes();if(daysonly&&f==0&&g==0)return b=new Date(b.getTime()-1e3),h+monthdayString(b.getUTCMonth()+1,b.getUTCDate());if(d!=i||e!=j)h+=monthdayString(i,j);return h+minhour(f,g)}function setlocal(a,b){if(capacity)return;var c="",d,e;b&&(d=get_offset(b),d[0]!=0&&(e=d[2].getUTCDate(),c=(e!=b.getUTCDate()?monthdayString(d[2].getUTCMonth()+1,e)+" ":"")+minhour(d[2].getUTCHours(),d[2].getUTCMinutes())+" "+d[1])),$(a.replace("_time","m")).innerHTML=c}function prettyLocal(a,b){var c=get_offset(a),d=get_offset(b);return c[0]!=0||d[0]!=0?'<div class="g">'+c[1]+" "+prettyTime(c[2],d[2],c[2].getUTCDate()!=a.getUTCDate())+(c[1]!=d[1]?" "+d[1]:"")+"</div>":""}function get_offset(a){var b,c;return b=to_utc[1]&&to_utc[1]<=a?to_utc[2]:to_utc[0],local[2]&&local[2]<=new Date(a.getTime()-1e3*b)?(b-=local[3],c=local[4]):(b-=local[0],c=local[1]),[b,c,new Date(a.getTime()-1e3*b)]}function showIndicator(a,b){return!submitted&&(!b||$(b).visible())?(submitted=!0,picked_el&&hide_datepick(picked_el,!1,picked_el.name.indexOf("finish")==-1),ProgressImg=$(a),$(a).show(),setTimeout("ProgressImg.src = ProgressImg.src",100),!0):!1}function dragEnd(a){var b=a.element;$(b.id+"_xpos").value=parseInt(b.style.left),$(b.id+"_ypos").value=parseInt(b.style.top)}function setFinish(a){a=a.replace(/_.*/,"");var b=$(a+"_field_2_r");dp_length=-1;if(!b.value.blank()){var c=b.options[b.selectedIndex].text;/((\d{1,3}):)?(\d{1,2}):(\d\d)[^:0-9]*/.test(c)?dp_length=((Number(RegExp.$2||0)*24+Number(RegExp.$3))*60+Number(RegExp.$4))*6e4:/(\d+)/.test(c)&&(dp_length=Number(RegExp.$1)*(daysonly?daylength:6e4))}var d=parsetime($(a+"_start_time").value);clearNset(a,"finish_time",d&&dp_length>=0?new Date(d.getTime()+dp_length):!1),dp_length=-1}function show_datepick(a,b){if(dp&&dp.visible()&&picked_el==a)return;if(dp&&picked_el==a&&new Date-dp_click<200){dp.show();return}picked_el=a;if(a.readOnly)return;picked=parsetime($(a.id).value),/finish/.test(a.id)&&calc_end(a.id);if(picked){pkd=picked.getUTCDate(),pkm=picked.getUTCMonth(),pky=picked.getUTCFullYear();if(/start/.test(a.id)){var c=parsetime($(a.id.replace(/start/,"finish")).value);c&&c>=picked?dp_length=c-picked:dp_length=-1}}else pky=0;picker=picked||(typeof cursor=="object"?cursor:new Date);if(dp==0){dp=$("datepick"),Event.observe(dp,"mousedown",datepick_observer);var d="";for(var e=0;e<7;e++)d+="<td>"+days[lang][(e+week_start)%7]+"</td>";$("pickdays").update(d)}update_datepick(0);var f=Position.cumulativeOffset(a);dp.setStyle({left:f[0]+b+"px",top:(f[1]<135?f[1]+24:f[1]-135)+"px"}),dp.show()}function parsetime(a){var b,c,d,e,f;if(date_pat.test(a)){b=RegExp.$1,b>1900&&b<2100?(c=RegExp.$2,d=RegExp.$3):(b=Number(RegExp.$3),b<100&&(b+=2e3),date_format==1?(c=RegExp.$1,d=RegExp.$2):(c=RegExp.$2,d=RegExp.$1));if(b>1900&&b<2100&&c<=12&&d<=31){if(time_pat.test(a)){e=Number(RegExp.$4),f=RegExp.$5,RegExp.$6&&(e%=12,RegExp.$6.toUpperCase()=="PM"&&(e+=12));if(e<=24&&f<60)return new Date(Date.UTC(b,c-1,d,e,f))}return/(\d{1,2})\s*(am|pm)/i.test(a)?(e=Number(RegExp.$1)%12,RegExp.$2.toUpperCase()=="PM"&&(e+=12),new Date(Date.UTC(b,c-1,d,e,0))):new Date(Date.UTC(b,c-1,d))}}return!1}function datepick_observer(a){var b=Event.element(a).id||Event.element(a).parentNode.id;if(date_pat.test(b)){pky=Number(RegExp.$1),pkm=Number(RegExp.$2),pkd=Number(RegExp.$3);var c=dateToString(pky,pkm+1,pkd);date_pat.test(picked_el.value)?picked_el.value=picked_el.value.replace(date_pat,c):/\d?\d:\d\d(\s*[pa]m)?/i.test(picked_el.value)?picked_el.value=c+"  "+RegExp.lastMatch:picked_el.value=c,update_datepick(0);if(dp_length>=0){var d=parsetime(picked_el.value),e=$(picked_el.id.replace(/start/,"finish"));e.value=timeToString(new Date(d.getTime()+dp_length))}reprice(picked_el.id)}return b=="up"&&update_datepick(1),b=="down"&&update_datepick(-1),dp_click=new Date,!0}function hide_datepick(a,b,c){var d;if(new Date-dp_click<150){picked_el.focus();return}b&&b>60&&(d=parsetime(picked_el.value),b*=1e3,d&&(picked_el.value=timeToString(d=new Date(Math.round(d.getTime()/b)*b)))),dp&&dp.hide(),local&&setlocal(picked_el.id,d?d:parsetime(picked_el.value)),c&&(length_sel?setFinish(a.id):calc_end(a.id)),a&&reprice(a.id)}function calc_end(a){if(typeof dp_length!="undefined"&&dp_length>=0){var b=parsetime($(a.replace(/finish/,"start")).value);if(b){var c=$(a.replace(/start/,"finish"));c.value=timeToString(new Date(b.getTime()+dp_length)),local&&setlocal(c.id,parsetime(c.value))}}dp_length=-1}function update_datepick(a){var b=picker.getUTCMonth()+a,c=picker.getUTCFullYear();if(b<0||b>11)b=(b+12)%12,c+=a,picker.setUTCFullYear(c);a!=0&&picker.setUTCMonth(b),$("pickhead").update(months[lang][b]+" "+c);var d=new Date,e=d.getDate(),f=d.getMonth(),g=d.getFullYear();d=new Date(beginning_of_week(new Date(Date.UTC(c,b,1,12,0))));var h="";for(var i=0;i<6;i++){h+="<tr>";for(var j=0;j<7;j++){var k=d.getUTCDate(),l=d.getUTCMonth(),m=d.getUTCFullYear(),n=[];k==e&&l==f&&m==g?n[0]="today":b!=l&&(n[0]="other"),k==pkd&&l==pkm&&m==pky&&n.push("picked"),h+="<td"+(n.length>0?' class="'+n.join(" ")+'"':"")+' id="dp'+m+"-"+l+"-"+k+'">'+k+"</td>",d.setTime(d.getTime()+daylength)}h+="</tr>";if(d.getUTCMonth()!=b)break}$("picknumbers").update(h)}function beginning_of_week(a){var b=a.getUTCDay()-week_start;return b<0&&(b+=7),a-b*daylength}function hotcell(a){$(a)&&(navigator.userAgent.indexOf("Safari/4")!=-1?new Effect.Appear(a):new Effect.Grow(a),first_cell&&(first_cell=!1,setTimeout('$("'+a+'").scrollIntoView(false)',100)))}function drawempty(a,b,c){var d,f,g,h=default_length/60,i,j=[],k=cs.getTime(),l=cs.getUTCDay();while(start[0]<=0){d=-start.shift();for(f=0;f<24;f++)j.push(d+f*60)}(d=start.indexOf(1440))!=-1&&(start[d]=0),start=start.concat(j),start.sort(function(a,b){return a-b});var m=res.length,n=o.length,p=start.length,q,r=new Array(m),s=0,t=e.length;for(d=0;d<m;d++)for(r[d]=0;r[d]<n;r[d]++)if(o[r[d]][1]==res[d])break;for(d=0;d<cl;d++){q=!0,i=d<v_first||d>=v_first+v_length?1:"",d>0&&(k+=daylength,l=(l+1)%7);for(f=0;f<p;f++){j=start[f]*6e4+k;while(s<t&&e[s][1]*1e3<=j-c)s++;if(s<t&&e[s][0]*1e3-c<j+h*6e4)continue;for(g=0;g<m;g++){if(ots&&ots[g]&&exceptional[d]==null){if(~ot_prefs[g]>>l&1)continue;if(start[f]<ots[g][l]||start[f]+h>ots[g][l+7]&&ots[g][l+7]<1440)continue;if(ot_prefs[g]>>l+7&1&&start[f]+h>ots[g][l+14]&&start[f]<ots[g][l+21])continue}else{if(open_time[d]==null)continue;if(start[f]<open_time[d]||start[f]+h>close_time[d]&&close_time[d]<1440)continue;if(breaks[d]&&start[f]+h>breaks[d][0]&&start[f]<breaks[d][1])continue}if(r[g]<n){while(r[g]<n&&o[r[g]][3]<=j-c)do r[g]++;while(r[g]<n&&o[r[g]][1]!=res[g]);if(r[g]<n&&o[r[g]][2]-c<default_length*1e3+j)continue}q=!1,i!=1&&start[f]+h>first_min&&start[f]<last_min&&(i+=drawechip(start[f],start[f]+h,g*100/m,100-(g+1)*100/m,'rd" id="e'+f+"_"+g,"e"+a,a))}}q?(f=$("m"+d),f&&f.addClassName("f"+b)):i!=1&&($("e"+d).innerHTML+=i)}}function drawfull(a){var b,c,d,f,g,h,i,j=e.length;if(j==0)return;for(d=v_first;d<v_first+v_length;d++){b=(d*daylength+cs.getTime())/1e3,c=b+daylength/1e3,i="";for(f=0;f<j&&e[f][0]<c;f++)e[f][1]>b&&(g=e[f][0]<b?-1:e[f][0]/60%1440,h=e[f][1]>c?1441:e[f][1]/60%1440,h==0&&(h=1440),g<last_min&&h>first_min&&(i+=drawechip(g,h,0,0,'nre" id="ex'+d+"_"+f,a,"x col"+a)));i&&($("e"+d).innerHTML+=i)}}function drawechip(a,b,c,d,e,f,g){var h=0,i;v_length>7?(e="achip "+e,h=.5):e="chip "+e;if(dir==1){h=Math.max((100-d-c)/100*line_height*(last_min-first_min)/60-6,5);var j=Math.max(Math.floor((Math.min(b,last_min)-Math.max(a,first_min))*100/(last_min-first_min)),1),k="",l="";i='<div style="top:'+c+"%;width:"+j+"%;left:"+Math.max(Math.floor((a-first_min)*100/(last_min-first_min)),0)+'%" class="'+e+'">';if(a>=first_min)b>last_min&&(k="l",l=";border-right-style:dashed");else{if(!(b<=last_min))return i+'<div style="height:'+(h+2)+'px;border-width:2px 1px 2px 1px" class="em'+g+' tbb"></div></div>';k="r",l=";border-left-style:dashed"}return i+='<div class="of'+k+" bcol"+f+'"></div><div class="if'+k+" bcol"+f+'"></div><div class="ef'+g+'"></div>',i+='<div style="height:'+h+"px"+l+'" class="em'+g+'"></div>',i+'<div class="ef'+g+'"></div><div class="if'+k+" bcol"+f+'"></div><div class="of'+k+" bcol"+f+'"></div></div>'}return i='<div style="top:'+Math.max(Math.floor((a-first_min)*line_height/60+h),0)+"px;left:"+c+"%;right:"+d+'%" class="'+e+'">',h=Math.max(Math.floor((Math.min(b,last_min)-Math.max(a,first_min))*line_height/60+h-2.2),5),a>=first_min?(i+='<div class="of bcol'+f+'"></div><div class="if bcol'+f+'"></div><div class="ef'+g+'"></div>',b<=last_min?(i+='<div style="height:'+(h-4)+'px" class="em'+g+'"></div>',i+='<div class="ef'+g+'"></div><div class="if bcol'+f+'"></div><div class="of bcol'+f+'"></div></div>'):i+='<div style="height:'+(h-2)+'px" class="em'+g+' bb"></div></div>'):b<=last_min?(i+='<div style="height:'+(h-2)+'px" class="em'+g+' tb"></div>',i+='<div class="ef'+g+'"></div><div class="if bcol'+f+'"></div><div class="of bcol'+f+'"></div></div>'):i+='<div style="height:'+h+'px" class="em'+g+' tb bb"></div></div>',i}function view_form(a,b){displaybox2("fbox",a.clientX,a.clientY),formcache!=b&&(formcache=form_id=b,abortajax(ajaxobj),$("content").innerHTML='<div style="padding:30px 50px"><img id="ajaxspin" src="//d304pchb3b61hb.cloudfront.net/img/progress.gif" alt="Busy..."/></div>',ajaxobj=new Ajax.Updater("content","/ajax/form/"+b+"?c=s",{method:"get"}))}function displaybox2(a,b,c){var d=$(a),e=d.style,f=document.viewport.getScrollOffsets().top;b=parseInt(b),c=parseInt(c)+f,e.left=b+"px",e.top=c+"px",d.show(),$("flash").visible()&&new Effect.Fade("flash")}function reprice(a){if(typeof price=="undefined")return;a=a.replace(/_.*/,"");var b=0,c=0,d=0,e=1;if(a=="oldres")c=5;else if(a!="reservation")return;var f=parsetime($((a+="_")+"start_time").value),g=parsetime($(a+"finish_time").value),h=$(a+"resource_id").value,i=$(a+"field_1_r"),j=$(a+"field_2_r");i&&(i=i.value),j&&(j=j.value);if(pcache[c]==f+1&&pcache[c+1]==g+1&&pcache[c+2]==h&&pcache[c+3]==i&&pcache[c+4]==j)return;pcache[c]=f+1,pcache[c+1]=g+1,pcache[c+2]=h,pcache[c+3]=i,pcache[c+4]=j;if(!f||!g||f>g)b=-1;else{var k,l,m,n,o=0,p=f.getTime()/1e3,q=p-p%86400,r=g.getTime()/1e3,s=p/60%1440;daysonly&&r%86400==0&&(typeof start=="undefined"||start[0]==1440)&&(r+=86400);var t=r-p,u=[p,r];if(price_unit>0&&t>0){var v=r-r%86400,w=r/60%1440;for(k=0;k<rules.length;k++){n=rules[k],n[2]!=n[3]&&(p<n[2]&&r>n[2]&&u.push(n[2]),p<n[3]&&r>n[3]&&u.push(n[3])),n[5]!=n[6]&&(s<n[5]&&(l=q+n[5]*60)<r&&u.push(l),v>p&&(n[5]&&!n[6]||n[6]&&!n[5])&&u.push(v),s<n[6]&&(l=q+n[6]*60)<r&&u.push(l),n[5]&&n[5]<w&&(l=v+n[5]*60)>p&&u.push(l),n[6]&&n[6]<w&&(l=v+n[6]*60)>p&&u.push(l));if(n[7])for(l=0;l<7;l++)m=(3<<l)%127,n[7]&m&&(n[7]&m)!=m&&(o|=1<<l)}if(o)for(l=v,k=(r/86400+4)%7;l>p&&u.length<200;l-=86400)o&1<<(k=(k+6)%7)&&u.push(l);u=u.sort(function(a,b){return a-b}).uniq(!0)}var x,y,z,A,B=(p-new Date/1e3+time_here)/60,C=[],D=[];for(l=0;l<u.length-1;l++){y=u[l],x=price,o=1<<(y/86400+4)%7,z=y/60%1440;for(k=0;k<rules.length;k++){n=rules[k];if((n[2]==n[3]?n[2]&&n[2]!=p:n[2]&&y<n[2]||n[3]&&y>=n[3])||n[4]&&n[4]!=h||(n[5]==n[6]?n[5]&&n[5]!=s:n[5]&&z<n[5]||n[6]&&z>=n[6])||n[7]&&n[7]&o||n[8]&&t<n[8]||n[9]&&t>=n[9]||n[10]&&B<n[10]||n[11]&&B>=n[11])continue;switch(n[0]){case 1:x=n[1];break;case 2:x+=n[1];break;case 3:x*=1+n[1]/1e4;break;case 4:x-=n[1];break;case 5:x*=1-n[1]/1e4;break;case 6:A=n[1];break;case 7:b=-1;case 8:k=999;break;case 9:case 12:C[n[1]]||(C[n[1]]=parsecfield(n[1]==1?i:j));switch(C[n[1]][0]){case 2:n[0]==9?x+=C[n[1]][1]:D[k]||(d+=D[k]=C[n[1]][1]);break;case 3:n[0]==9?x*=C[n[1]][1]:D[k]||(e*=D[k]=C[n[1]][1])}break;case 10:D[k]||(d+=D[k]=n[1]);break;case 11:D[k]||(d-=D[k]=n[1])}}b>=0&&(price_unit>0?b+=x*(u[l+1]-y)/price_unit:b=x)}}b>=0&&(b=(b+d)*e),b=show_currency(b>0&&A>0?Math.round(b/A)*A:b),a=="oldres_"?$(a+"price").innerHTML=$(a+"price_cents").innerHTML==b?"":" &rarr; "+b:$(a+"price").innerHTML=b}function parsecfield(a){return a&&(a=price_format%2==0?a.replace(/,(\d\d\d)/,"$1"):a.replace(/\.(\d\d\d)/,"$1").replace(",",".")),/(^|[^:])(-?\d+(\.\d+)?)(%)?($|\s)/.test(a)?RegExp.$4?[3,1+RegExp.$2/100]:[2,Math.floor(RegExp.$2*100)]:[0]}function format_price(a){var b,c=price_format,d=String(a=Math.floor(a));return(a=Math.abs(a))>=100?(b=d.slice(0,-2).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,c==0||c==2?"$1,":"$1."),c!=2&&c!=3||a%100!=0?b+(c%2==0?".":",")+d.slice(-2):b):a==0&&c>1?"0":"0"+(c==1||c==3?",":".")+(a<10?"0":"")+d}function show_currency(a){if(a<0||a=="")return"&ndash;";var b=currency;return a=format_price(a),typeof b=="string"?b.substring(b.length-1)==" "?b+a:a+" "+b:a+" "+b[a=="1"?0:1]}function creprice(a,b){var c=a;if(!b){if(typeof rules!="object")return;a=a.replace(/_.*/,"")+"_",c=$(a+"slot_id").value}var d=(c=chip[c])[7],e=0,f=1,g=1,h;!b&&$(a+"quantity")&&(f=$(a+"quantity").value,f=f>=1&&f<99999999?Math.floor(f):1);if(typeof rules=="object"){var i,j,k,l=c[1].getTime()/1e3,m=c[3]>0&&c[8]>=0?c[3]-c[8]:"?",n=1<<(l/86400+4)%7,o=(l-(c[11]||new Date)/1e3+time_here)/60;if(!b)var p=$(a+"field_1_r"),q=$(a+"field_2_r");for(i=0;i<rules.length;i++){j=rules[i];if(j[4]&&m=="?"){d=-9,i=999;continue}if((j[2]==j[3]?j[2]&&j[2]!=l:j[2]&&l<j[2]||j[3]&&l>=j[3])||j[4]&&(j[4]!=2&&m<j[5]||j[4]!=3&&m>j[6])||j[7]&&j[7]&n||j[8]&&f<j[8]||j[9]&&f>j[9]||j[10]&&o<j[10]||j[11]&&o>=j[11])continue;switch(j[0]){case 1:d=j[1];break;case 2:d+=j[1];break;case 3:d*=1+j[1]/1e4;break;case 4:d-=j[1];break;case 5:d*=1-j[1]/1e4;break;case 6:h=j[1];break;case 7:d=-1;case 8:i=999;break;case 9:case 12:if(!b){if(k=j[1]==1?p:q)k=k.value;k=parsecfield(k);switch(k[0]){case 2:j[0]==9?d+=k[1]:e+=k[1];break;case 3:j[0]==9?d*=k[1]:g*=k[1]}}break;case 10:e+=j[1];break;case 11:e-=j[1]}}}d>=0&&(d=(d*f+e)*g,h>0&&(d=Math.round(d/h)*h)),k=show_currency(d);if(b)return d>0?k:"";a=="oldbooking_"?$(a+"price").innerHTML=$(a+"price_cents").innerHTML==k?"":" &rarr; "+k:$(a+"price").innerHTML=k}function markdown(a){return a.escapeHTML().replace(/\n/g,"\n<br/>").replace(/"/g,"&quot;").replace(/(\[([^\]]+)\]\s*)?(https?:\/\/(\S+))/g,function(a,b,c,d,e){return/\.(gif|png|jpg)$/i.test(d)?'<img alt="'+(c?c+'" title="'+c:"")+'" src="'+d+'"/>':'<a href="'+d+'">'+(c||e)+"</a>"})}var accid=-2,enabled=1,ignoref="created_by updated_by appointment_id status super_field form_id",ajaxobj,ajaxobj2,ajaxobj3,newcache,statcache="?",edtarget=!1,submitted=!1,months=[["January","February","March","April","May","June","July","August","September","October","November","December"],["Januari","Februari","Maart","April","Mei","Juni","Juli","Augustus","September","Oktober","November","December"],["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],["Januar","Februar","Marts","April","Maj","Juni","Juli","August","September","Oktober","November","December"],["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kesäkuu","Heinäkuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"],["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],["Januar","Februar","Mars","April","Mai","Juni","Juli","August","September","Oktober","November","Desember"],["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"],["Leden","Únor","Březen","Duben","Květen","Červen","Červenec","Srpen","Září","Říjen","Listopad","Prosinec"],["Januar","Februar","Mart","april","Maj","Jun","Jul","Avgust","Septembar","Oktobar","Novembar","Decembar"],["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Pazdziernik","Listopad","Grudzień"],["Sausis","Vasaris","Kovas","Balandis","Gegužė","Birželis","Liepa","Rugpjūtis","Rugsėjis","Spalis","Lapkritis","Gruodis"],["Január","Február","Marec","Apríl","Máj","Jún","Júl","August","September","Október","November","December"],["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],["Ιανουάριος","Φεβρουάριος","Μάρτιος","Απρίλιος","Μάιος","Ιούνιος","Ιούλιος","Αύγουστος","Σεπτέμβριος","Οκτώβριος","Νοέμβριος","Δεκέμβριος"],["Janur","Februar","Marec","April","Maj","Junij","Julij","Avgust","September","Oktober","November","December"],["Siječan","Veljača","Ožujak","Travanj","Svibanj","Lipanj","Srpanj","Kolovoz","Rujan","Listopad","Studeni","Prosinac"],["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"]],days=[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Zo","Ma","Di","Wo","Do","Vr","Za"],["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],["So","Mo","Di","Mi","Do","Fr","Sa"],["Do","Lu","Ma","Mi","Ju","Vi","Sa"],["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],["Søn","Man","Tir","Ons","Tor","Fre","Lør"],["Su","Ma","Ti","Ke","To","Pe","La"],["Sön","Mån","Tis","Ons","Tor","Fre","Lör"],["Søn","Man","Tir","Ons","Tor","Fre","Lør"],["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],["Ne","Po","Út","St","Čt","Pá","So"],["Ned","Pon","Uto","Sre","Čet","Pet","Sub"],["日","月","火","水","木","金","土"],["א","ב","ג","ד","ה","ו","ש"],["Nd","Pn","Wt","Śr","Czw","Pt","So"],["Sk","Pr","An","Tr","Kt","Pn","Šš"],["Ned","Pon","Uto","Str","Štv","Pia","Sob"],["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],["Κυρ","Δευ","Τρι","Τετ","Πεμ","Παρ","Σαβ"],["Ned","Pon","Tor","Sre","Čet","Pet","Sob"],["Ned","Pon","Uto","Sri","Čet","Pet","Sub"],["أحد","إثنين","ثلاثاء","أربعاء","خميس","جمعه","سبت"]],ind=[["available","full","overbooked","1 waiting","waiting"],["beschikbaar","vol","overvol","1 wachtende","wachtenden"],["disponível","lotado","excedente","1 na espera","aguardando"],["verfügbar","ausgebucht","überbucht","1 wartet","warten"],["disponible","completo","overbooking","1 esperando","esperando"],["disponibile(i)","completo","sovraprenotato","1 in attesa","in attesa"],["ledig","fyldt","overbooked","1 venter","wenter"],["vapaana","täynnä","ylibuukkaus","1 odottava","odottavaa"],["ledig","fullbokad","överbokad","1 på kö","på kö"],["ledig","fullt","overbooket","1 venter","venter"],["Disponible","Complet","Réservé","1 en attente","en attente"],["dostupný","plno","přeplněno","1 čekající","čekající"],["dostupno","zauzeto","prebukirano","1 na čekanju","na čekanju"],["予約可能","満席","予約超過","1 人待ち","人待ち"],["זמין","מלא","מעל התפוסה","1 ממתין","ממתינים"],["dostępny","pełny","przeciążony","1 oczekujący","oczekujących"],["laisva","užimta","perpildyta","1 laukia","laukia"],["voľné","obsadené","prebukované","1 čakajúci","čakajúci(ich)"],["现有","已满","人员超数","一个在等待","等待"],["Διαθέσιμο","Πλήρες","υπερπλήρες","1 στην αναμονή","αναμένουν"],["dosegljivo","zasedeno","prezasedeno","1 čakajoč","čakajočih"],["dostupno","popunjeno","prepunjeno","1 čeka","čekaju"],["متاح"
,"كامل العدد","فوق الحد الأقصى","1 ينتظر","ينتظرون"]],delete_warning=[!1,"Bijbehorende reserveringen worden ook verwijderd. Weet u het zeker?",!1,"Dies wird auch Reservierungen löschen. Sind Sie sicher?","Esto también eliminará reservas. ¿Está seguro?","Questo cancellerà anche le prenotazioni. Sei sicuro di voler procedere?","Dette vil også slette reservationer. Er du sikker?",!1,!1,!1,"Ceci effacera également les réservations. Etes vous sûr?","Toto smaže všechny rezervace. Jste si jisti?",!1,"この予約を削除します。よろしいですか？"],daylength=864e5,date_pat=/(\d+)\s*[-\/\\\.]\s*(\d\d?)\s*[-\/\\\.]\s*(\d+)/,time_pat=/(\d+)\s*[-\/\\\.]\s*(\d\d?)\s*[-\/\\\.]\s*(\d+)\s*(\d\d?)[:.](\d\d)\s*([aApP][mM])?/,picked,pky,pkm,pkd,picker,picked_el=!1,dp=!1,dp_click=0,dp_length=-1,first_cell=!0,formcache=!1,pcache=[]